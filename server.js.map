{"version":3,"file":"server.js","sourceRoot":"/","sources":["server.ts"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,OAAO,CAAC,qBAAqB,CAAC,CAAC;AAE/B,kFAAuE;AACvE,oFAAyE;AACzE,kEAA2D;AAC3D,gDAAwB;AAExB,MAAM,eAAe,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;AACtC,MAAM,eAAe,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC;AAC3C,MAAM,MAAM,GAAG,OAAO,CAAC,cAAc,CAAC,CAAC;AACvC,MAAM,OAAO,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC;AACnC,MAAM,UAAU,GAAG,OAAO,CAAC,aAAa,CAAC,CAAC;AAC1C,MAAM,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;AAC7B,MAAM,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAEjC,MAAM,wBAAwB,GAAG,GAAG,EAAE;IAClC,MAAM,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,UAAU,KAAK,YAAY;QACnD,CAAC,CAAC,mBAAmB;QACrB,CAAC,CAAC,gBAAgB,CAAC;IACvB,MAAM,CAAC,MAAM,CAAC,EAAE,IAAI,EAAE,cAAI,CAAC,OAAO,CAAC,SAAS,EAAE,OAAO,CAAC,EAAE,CAAC,CAAC;IAC1D,OAAO,CAAC,GAAG,CAAC,2BAA2B,OAAO,EAAE,CAAC,CAAC;AACtD,CAAC,CAAC;AAEF,wBAAwB,EAAE,CAAC;AAC3B,IAAA,mBAA0B,GAAE,CAAC;AAE7B,MAAM,cAAc,GAAG,GAAG,EAAE;IACxB,MAAM,GAAG,GAAG,OAAO,EAAE,CAAC;IACtB,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,CAAC;IAC3B,GAAG,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC;IAChB,MAAM,CAAC,wBAAwB,CAAC,GAAG,CAAC,CAAC;IACrC,MAAM,iBAAiB,GAAG,OAAO,CAAC,GAAG,CAAC,iBAAiB,IAAI,IAAI,CAAC;IAEhE,GAAG,CAAC,GAAG,CAAC,UAAU,EAAE,oBAAuB,CAAC,CAAC;IAC7C,GAAG,CAAC,GAAG,CAAC,kBAAkB,EAAE,qBAAwB,CAAC,CAAC;IAEtD,GAAG,CAAC,MAAM,CAAC,iBAAiB,EAAE,GAAS,EAAE;QACrC,OAAO,CAAC,GAAG,CAAC,uCAAuC,iBAAiB,EAAE,CAAC,CAAC;IAC5E,CAAC,CAAA,CAAC,CAAC;AACP,CAAC,CAAC;AAEF,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,CAAC;IAC1B,IAAI,eAAe,CAAC,QAAQ,EAAE,CAAC;QAC3B,MAAM,OAAO,GAAG,eAAe,CAAC,IAAI,EAAE,CAAC,MAAM,CAAC;QAC9C,OAAO,CAAC,GAAG,CAAC,kBAAkB,OAAO,CAAC,GAAG,aAAa,CAAC,CAAC;QACxD,OAAO,CAAC,GAAG,CAAC,sBAAsB,OAAO,OAAO,CAAC,CAAC;QAClD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,EAAE,CAAC,EAAE,EAAE,CAAC;YAC/B,eAAe,CAAC,IAAI,EAAE,CAAC;QAC3B,CAAC;QACD,eAAe,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC,MAAmC,EAAE,IAAS,EAAE,MAAW,EAAE,EAAE;YACvF,OAAO,CAAC,GAAG,CAAC,UAAU,MAAM,CAAC,OAAO,CAAC,GAAG,iCAAiC,CAAC,CAAC;YAC3E,eAAe,CAAC,IAAI,EAAE,CAAC;QAC3B,CAAC,CAAC,CAAC;IACP,CAAC;SAAM,CAAC;QACJ,cAAc,EAAE,CAAC;IACrB,CAAC;AACL,CAAC;KAAM,CAAC;IACJ,cAAc,EAAE,CAAC;AACrB,CAAC","sourcesContent":["require(\"./Common/instrument\");\r\nimport { Request, Response, NextFunction } from 'express';\r\nimport user_controlling_routes from './Routes/user_routers/userRouter';\r\nimport admin_controlling_routes from './Routes/admin_routes/adminRoutes';\r\nimport connection_DB_estaiblished from './DB/DB/db_config';\r\nimport path from 'path';\r\n\r\nconst operatingSystem = require('os');\r\nconst clusterPremises = require('cluster');\r\nconst Sentry = require(\"@sentry/node\");\r\nconst express = require('express');\r\nconst bodyParser = require('body-parser');\r\nconst cors = require('cors');\r\nconst dotenv = require('dotenv');\r\n\r\nconst loadEnvironmentVariables = () => {\r\n    const envFile = process.env.VERCEL_ENV === 'production' \r\n        ? './.env.production' \r\n        : './.env.staging';\r\n    dotenv.config({ path: path.resolve(__dirname, envFile) });\r\n    console.log(`Loaded environment from ${envFile}`);\r\n};\r\n\r\nloadEnvironmentVariables();\r\nconnection_DB_estaiblished();\r\n\r\nconst server_configs = () => {\r\n    const app = express();\r\n    app.use(bodyParser.json());\r\n    app.use(cors());\r\n    Sentry.setupExpressErrorHandler(app);\r\n    const PORT_ESTAIBLISHED = process.env.PORT_ESTAIBLISHED || 8000;\r\n\r\n    app.use('/api/v1/', user_controlling_routes);\r\n    app.use('/api/v1/controls', admin_controlling_routes);\r\n\r\n    app.listen(PORT_ESTAIBLISHED, async () => {\r\n        console.log(`Server running successfully on port ${PORT_ESTAIBLISHED}`);\r\n    });\r\n};\r\n\r\nif (!process.env.VERCEL_ENV) {\r\n    if (clusterPremises.isMaster) {\r\n        const numCPUs = operatingSystem.cpus().length;\r\n        console.log(`Master process ${process.pid} is running`);\r\n        console.log(`Forking server for ${numCPUs} CPUs`);\r\n        for (let i = 0; i < numCPUs; i++) {\r\n            clusterPremises.fork();\r\n        }\r\n        clusterPremises.on('exit', (worker: { process: { pid: any; }; }, code: any, signal: any) => {\r\n            console.log(`Worker ${worker.process.pid} died. Starting a new worker...`);\r\n            clusterPremises.fork();\r\n        });\r\n    } else {\r\n        server_configs();\r\n    }\r\n} else {\r\n    server_configs();\r\n}\r\n"]}